<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Building a data lake on Microsoft Azure. | Harish Kesava Rao</title> <meta name="author" content="Harish Kesava Rao"> <meta name="description" content="Building and deploying a data lake on Azure infrastructure."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="http://harishkesavarao.github.io//blog/2023/azure-data-lake/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Harish Kesava Rao</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Building a data lake on Microsoft Azure.</h1> <p class="post-meta">March 1, 2023</p> <p class="post-tags"> <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/bigdata"> <i class="fas fa-hashtag fa-sm"></i> bigdata</a>   <a href="/blog/tag/azure"> <i class="fas fa-hashtag fa-sm"></i> azure</a>   <a href="/blog/tag/data-engineering"> <i class="fas fa-hashtag fa-sm"></i> data-engineering</a>   <a href="/blog/tag/scala"> <i class="fas fa-hashtag fa-sm"></i> scala</a>   <a href="/blog/tag/python"> <i class="fas fa-hashtag fa-sm"></i> python</a>   </p> </header> <article class="post-content"> <div id="table-of-contents"> <ul id="toc" class="section-nav"> <li class="toc-entry toc-h1"> <a href="#introduction">Introduction</a> <ul> <li class="toc-entry toc-h2"><a href="#pre-requisite-reading">Pre-requisite reading</a></li> <li class="toc-entry toc-h2"><a href="#infrastructure-as-code-iac">Infrastructure as Code (IaC)</a></li> <li class="toc-entry toc-h2"><a href="#what-is-a-data-lake">What is a Data Lake?</a></li> </ul> </li> <li class="toc-entry toc-h1"><a href="#use-cases">Use cases</a></li> <li class="toc-entry toc-h1"> <a href="#data-sources">Data sources</a> <ul> <li class="toc-entry toc-h2"> <a href="#azure-storage-account">Azure Storage Account</a> <ul> <li class="toc-entry toc-h3"><a href="#authentication-and-authorization">Authentication and authorization</a></li> </ul> </li> <li class="toc-entry toc-h2"> <a href="#azure-event-hubs">Azure Event Hubs</a> <ul> <li class="toc-entry toc-h3"><a href="#authentication-and-authorization-1">Authentication and authorization</a></li> </ul> </li> </ul> </li> <li class="toc-entry toc-h1"> <a href="#ingestion">Ingestion</a> <ul> <li class="toc-entry toc-h2"><a href="#azure-storage-account-1">Azure Storage Account</a></li> <li class="toc-entry toc-h2"><a href="#azure-event-hubs-1">Azure Event Hubs</a></li> </ul> </li> <li class="toc-entry toc-h1"> <a href="#design-decisions-and-trade-offs">Design decisions and trade-offs</a> <ul> <li class="toc-entry toc-h2"><a href="#compute">Compute</a></li> <li class="toc-entry toc-h2"><a href="#storage--azure-storage-account">Storage / Azure Storage Account</a></li> <li class="toc-entry toc-h2"><a href="#analytics">Analytics</a></li> </ul> </li> <li class="toc-entry toc-h1"><a href="#conclusion">Conclusion</a></li> </ul> </div> <hr> <div id="markdown-content"> <h1 id="introduction">Introduction</h1> <h2 id="pre-requisite-reading">Pre-requisite reading</h2> <p>In order to fully understand or follow along with the article, I recommend reading some of the documents, articles and other links I have included in this section. If you have already worked on the Azure services I have listed below, you can skip this section.</p> <ol> <li><a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-account-overview" rel="external nofollow noopener" target="_blank">Storage account overview.</a></li> <li><a href="https://learn.microsoft.com/en-us/devops/deliver/what-is-infrastructure-as-code" rel="external nofollow noopener" target="_blank">IaC on Azure.</a></li> <li><a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/overview" rel="external nofollow noopener" target="_blank">Azure Resource Manager.</a></li> <li><a href="https://learn.microsoft.com/en-us/entra/identity-platform/app-objects-and-service-principals?tabs=browser" rel="external nofollow noopener" target="_blank">Azure Service Principals.</a></li> <li><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/role-assignments-steps" rel="external nofollow noopener" target="_blank">Azure role-based access control (RBAC).</a></li> <li><a href="https://learn.microsoft.com/en-us/azure/event-hubs/event-hubs-about" rel="external nofollow noopener" target="_blank">Azure Event Hubs.</a></li> <li><a href="https://learn.microsoft.com/en-us/azure/databricks/structured-streaming/production" rel="external nofollow noopener" target="_blank">Production considerations for Structured Streaming.</a></li> <li><a href="https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/monitor-azure-resource#monitoring-data" rel="external nofollow noopener" target="_blank">Azure Monitor.</a></li> <li><a href="https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-types" rel="external nofollow noopener" target="_blank">Azure Monitor Alerts</a></li> <li><a href="https://learn.microsoft.com/en-us/azure/storage/blobs/lifecycle-management-overview" rel="external nofollow noopener" target="_blank">Lifecycle Management Policies for Azure Storage Account.</a></li> </ol> <h2 id="infrastructure-as-code-iac">Infrastructure as Code (IaC)</h2> <p>All of the Azure cloud resources discussed can be created manually via the Azure Portal.</p> <p>In a production deployment, that is seldom the case. We typically use an Infrastructure as Code deployment to manage resources. Azure provides native support for IaC via the <a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/overview" rel="external nofollow noopener" target="_blank">Azure Resource Manager</a> model.</p> <p>Azure supports other third-party platforms such as Terraform. To illustrate resource creation in this article, I will use Terraform examples for resource creation.</p> <h2 id="what-is-a-data-lake">What is a Data Lake?</h2> <blockquote> <p>A data lake is a centralized repository that ingests and stores large volumes of data in its original form. The data can then be processed and used as a basis for a variety of analytic needs. Due to its open, scalable architecture, a data lake can accommodate all types of data from any source, from structured (database tables, Excel sheets) to semi-structured (XML files, webpages) to unstructured (images, audio files, tweets), all without sacrificing fidelity. The data files are typically stored in staged zones—raw, cleansed, and curated—so that different types of users may use the data in its various forms to meet their needs. Data lakes provide core data consistency across a variety of applications, powering big data analytics, machine learning, predictive analytics, and other forms of intelligent action.</p> <p><cite>– Microsoft Azure Documentation.</cite></p> </blockquote> <h1 id="use-cases">Use cases</h1> <p>It is cost effective and performant to build a Data Lake when the data volume is over a certain threshold. The threshold is usually in the tens of GBs of data per day and continues to accumulate over time. If the data volume is less than that, it would be quicker and cheaper to build a traditional data warehouse or other solutions.</p> <p>As we saw above, a Data Lake is a centralized repository which stores all of the structured and unstructured data. This means that this data is available to anyone in an organization (with the relevant permissions). This could be - Data Analysts, Data Scientists, Data Engineers, Business Analysts, Product Managers, Finance or any other function. This offers a single source of truth of the data and each sub-function or department within an organization can choose to use the data as they see fit, with their own tooling for data access, analytics and visualization.</p> <h1 id="data-sources">Data sources</h1> <p>From what I have seen, most data sources in Azure fall under one of two types: Azure Storage Account and Eventhubs (streaming). We will discuss the following topics for these two data sources:</p> <ul> <li>How are we authenticating to these sources before ingesting data from them?</li> <li>What are the most efficient methods to ingest data from the two source types?</li> </ul> <p>We will not discuss the destination storage in this section. We will do it in the design decisions section.</p> <h2 id="azure-storage-account">Azure Storage Account</h2> <p><a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-account-overview" rel="external nofollow noopener" target="_blank">Related Azure Doc.</a></p> <p>There are many types of storage accounts. For the purpose of this article, we will discuss Standard general-purpose v2, which supports the Azure Blob Storage (and Data Lake Storage) service.</p> <div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"azurerm_resource_group"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>     <span class="o">=</span> <span class="s2">"example-resources"</span>
  <span class="nx">location</span> <span class="o">=</span> <span class="s2">"West Europe"</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_storage_account"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>                     <span class="o">=</span> <span class="s2">"storageaccountname"</span>
  <span class="nx">resource_group_name</span>      <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">location</span>                 <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">location</span>
  <span class="nx">account_tier</span>             <span class="o">=</span> <span class="s2">"Standard"</span>
  <span class="nx">account_replication_type</span> <span class="o">=</span> <span class="s2">"GRS"</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">environment</span> <span class="o">=</span> <span class="s2">"staging"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><cite> – Terraform Docs.</cite></p> <h3 id="authentication-and-authorization">Authentication and authorization</h3> <p>Options to authenticate to a storage account in Azure.</p> <p><strong>Azure AD/Entra ID and Azure RBAC</strong></p> <p>Azure Active Directory and Entra ID are the same.</p> <p>You can always define the following authentication keys using the Azure Portal, Azure CLI or other manual/UI means. For a production system, it is important to think of automated deployment of resources using IaC and via <a href="https://en.wikipedia.org/wiki/CI/CD" rel="external nofollow noopener" target="_blank">CI/CD.</a> In this context, Azure recommends using what is called as an Application and an associated Service Principal.</p> <p><em>Excerpt from Azure Docs below:</em></p> <blockquote> <p>Automated tools that use Azure services should always have restricted permissions. Instead of having applications sign in as a fully privileged user, Azure offers service principals.</p> <p>An Azure service principal is an identity created for use with applications, hosted services, and automated tools to access Azure resources. This access is restricted by the roles assigned to the service principal, giving you control over which resources can be accessed and at which level. For security reasons, it’s always recommended to use service principals with automated tools rather than allowing them to log in with a user identity.</p> <p>Microsoft recommends using Service Principals to authenticate access to resources as much as possible. To understand how to create Service Principals, how they are related to an Application, Tenant and resources, please read the sections on Service Principal and Azure RBAC.</p> <p><cite>– Microsoft Azure Documentation.</cite></p> </blockquote> <p>Setting up access to an Azure Storage Account via an Azure Service Principal is explained <a href="https://learn.microsoft.com/en-us/dynamics365/customer-insights/data/connect-service-principal" rel="external nofollow noopener" target="_blank">here.</a></p> <p><strong><a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-account-keys-manage?tabs=azure-portal" rel="external nofollow noopener" target="_blank">Shared Key (WARNING: has full access to the storage account config and data)</a></strong> a shared key is passed with every request to the storage account. The shared key is created along with each storage account and can be used for authorization. Since it contains full access to a storage account, it is discouraged to use this as a standard authorization option.</p> <p>If you choose to use the shared key to access a Storage Account, an associated <a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-configure-connection-string?toc=/azure/storage/blobs/toc.json&amp;bc=/azure/storage/blobs/breadcrumb/toc.json" rel="external nofollow noopener" target="_blank">connection string</a> needs to be generated alongside the shared key.</p> <p><strong>Delegated access with shared access signatures (SAS)</strong></p> <blockquote> <p>A shared access signature (SAS) enables you to grant limited access to containers and blobs in your storage account. When you create a SAS, you specify its constraints, including which Azure Storage resources a client is allowed to access, what permissions they have on those resources, and how long the SAS is valid.</p> <p><cite>– Microsoft Azure Documentation.</cite></p> </blockquote> <p>More information on creating a SAS token <a href="https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blob-user-delegation-sas-create-cli" rel="external nofollow noopener" target="_blank">here</a>. The article explains using a security principal (an user, group or a Service Principal) to first assign the <code class="language-plaintext highlighter-rouge">Microsoft.Storage/storageAccounts/blobServices/generateUserDelegationKey</code> action to the security principal or via an RBAC such as <code class="language-plaintext highlighter-rouge">Storage Blob Data Contributor</code> and then use the permissions to then create an user delegated SAS using it.</p> <div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"azurerm_resource_group"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>     <span class="o">=</span> <span class="s2">"resourceGroupName"</span>
  <span class="nx">location</span> <span class="o">=</span> <span class="s2">"West Europe"</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_storage_account"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>                     <span class="o">=</span> <span class="s2">"storageaccountname"</span>
  <span class="nx">resource_group_name</span>      <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">location</span>                 <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">location</span>
  <span class="nx">account_tier</span>             <span class="o">=</span> <span class="s2">"Standard"</span>
  <span class="nx">account_replication_type</span> <span class="o">=</span> <span class="s2">"GRS"</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">environment</span> <span class="o">=</span> <span class="s2">"staging"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">data</span> <span class="s2">"azurerm_storage_account_sas"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">connection_string</span> <span class="o">=</span> <span class="nx">azurerm_storage_account</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">primary_connection_string</span>
  <span class="nx">https_only</span>        <span class="o">=</span> <span class="kc">true</span>
  <span class="nx">signed_version</span>    <span class="o">=</span> <span class="s2">"2017-07-29"</span>

  <span class="nx">resource_types</span> <span class="p">{</span>
    <span class="nx">service</span>   <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">container</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="nx">object</span>    <span class="o">=</span> <span class="kc">false</span>
  <span class="p">}</span>

  <span class="nx">services</span> <span class="p">{</span>
    <span class="nx">blob</span>  <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">queue</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="nx">table</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="nx">file</span>  <span class="o">=</span> <span class="kc">false</span>
  <span class="p">}</span>

  <span class="nx">start</span>  <span class="o">=</span> <span class="s2">"2018-03-21T00:00:00Z"</span>
  <span class="nx">expiry</span> <span class="o">=</span> <span class="s2">"2020-03-21T00:00:00Z"</span>

  <span class="nx">permissions</span> <span class="p">{</span>
    <span class="nx">read</span>    <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">write</span>   <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">delete</span>  <span class="o">=</span> <span class="kc">false</span>
    <span class="nx">list</span>    <span class="o">=</span> <span class="kc">false</span>
    <span class="nx">add</span>     <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">create</span>  <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">update</span>  <span class="o">=</span> <span class="kc">false</span>
    <span class="nx">process</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="nx">tag</span>     <span class="o">=</span> <span class="kc">false</span>
    <span class="nx">filter</span>  <span class="o">=</span> <span class="kc">false</span>
  <span class="err">}</span>
<span class="p">}</span>

<span class="k">output</span> <span class="s2">"sas_url_query_string"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="o">=</span> <span class="k">data</span><span class="p">.</span><span class="nx">azurerm_storage_account_sas</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">sas</span>
<span class="p">}</span>
</code></pre></div></div> <p><cite> – Terraform Docs.</cite></p> <h2 id="azure-event-hubs">Azure Event Hubs</h2> <p><a href="https://learn.microsoft.com/en-us/azure/event-hubs/event-hubs-about" rel="external nofollow noopener" target="_blank">Related Azure doc.</a></p> <blockquote> <p>Azure Event Hubs is a cloud native data streaming service that can stream millions of events per second, with low latency, from any source to any destination. Event Hubs is compatible with Apache Kafka, and it enables you to run existing Kafka workloads without any code changes.</p> <p><cite>– Microsoft Azure Documentation.</cite></p> </blockquote> <p>Eventhubs allows ingesting streaming data to a data lake. We will confine our discussion to receiving data, setting up authorization and a few other basics in this section. Ingestion data will be discussed in the Ingestion section for Event Hubs.</p> <div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"azurerm_resource_group"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>     <span class="o">=</span> <span class="s2">"example-resources"</span>
  <span class="nx">location</span> <span class="o">=</span> <span class="s2">"West Europe"</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_eventhub_namespace"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>                <span class="o">=</span> <span class="s2">"acceptanceTestEventHubNamespace"</span>
  <span class="nx">location</span>            <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">location</span>
  <span class="nx">resource_group_name</span> <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">sku</span>                 <span class="o">=</span> <span class="s2">"Standard"</span>
  <span class="nx">capacity</span>            <span class="o">=</span> <span class="mi">1</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">environment</span> <span class="o">=</span> <span class="s2">"Production"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_eventhub"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>                <span class="o">=</span> <span class="s2">"acceptanceTestEventHub"</span>
  <span class="nx">namespace_name</span>      <span class="o">=</span> <span class="nx">azurerm_eventhub_namespace</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">resource_group_name</span> <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">partition_count</span>     <span class="o">=</span> <span class="mi">2</span>
  <span class="nx">message_retention</span>   <span class="o">=</span> <span class="mi">1</span>
<span class="p">}</span>
</code></pre></div></div> <p><cite> – Terraform Docs.</cite></p> <h3 id="authentication-and-authorization-1">Authentication and authorization</h3> <p>The authorization mechanism for event hubs is similar to the SAS token we discussed for Azure Storage Account, with the only difference being, we can define authorization policies associated with each event hubs topic (you can define a SAS token for an eventhubs namespace or as well, but I prefer to do it a event hubs topic level to keep it more granular). The policy defines the level of access for the SAS token.</p> <p><a href="https://learn.microsoft.com/en-us/azure/event-hubs/authenticate-shared-access-signature" rel="external nofollow noopener" target="_blank">Authentication</a> and <a href="https://learn.microsoft.com/en-us/azure/event-hubs/authorize-access-shared-access-signature" rel="external nofollow noopener" target="_blank">authorization</a> using a shared access signature.</p> <p>You can generate SAS authorization policies and tokens using the Security Principal method described above in the Storage Account’s Authorization section.</p> <div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"azurerm_resource_group"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>     <span class="o">=</span> <span class="s2">"example-resources"</span>
  <span class="nx">location</span> <span class="o">=</span> <span class="s2">"West Europe"</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_eventhub_namespace"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>                <span class="o">=</span> <span class="s2">"acceptanceTestEventHubNamespace"</span>
  <span class="nx">location</span>            <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">location</span>
  <span class="nx">resource_group_name</span> <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">sku</span>                 <span class="o">=</span> <span class="s2">"Basic"</span>
  <span class="nx">capacity</span>            <span class="o">=</span> <span class="mi">2</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">environment</span> <span class="o">=</span> <span class="s2">"Production"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_eventhub"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>                <span class="o">=</span> <span class="s2">"acceptanceTestEventHub"</span>
  <span class="nx">namespace_name</span>      <span class="o">=</span> <span class="nx">azurerm_eventhub_namespace</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">resource_group_name</span> <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">partition_count</span>     <span class="o">=</span> <span class="mi">2</span>
  <span class="nx">message_retention</span>   <span class="o">=</span> <span class="mi">2</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_eventhub_authorization_rule"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>                <span class="o">=</span> <span class="s2">"navi"</span>
  <span class="nx">namespace_name</span>      <span class="o">=</span> <span class="nx">azurerm_eventhub_namespace</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">eventhub_name</span>       <span class="o">=</span> <span class="nx">azurerm_eventhub</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">resource_group_name</span> <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">listen</span>              <span class="o">=</span> <span class="kc">true</span>
  <span class="nx">send</span>                <span class="o">=</span> <span class="kc">false</span>
  <span class="nx">manage</span>              <span class="o">=</span> <span class="kc">false</span>
<span class="p">}</span>
</code></pre></div></div> <p><cite> – Terraform Docs.</cite></p> <h1 id="ingestion">Ingestion</h1> <p>So far, we have discussed data sources and associated authorization mechanisms. Now, we will discuss methods to ingest data from the different data sources using the configured authorization. A few design questions related to ingestion:</p> <ul> <li>How frequently do you need to ingest - batch, streaming?</li> <li>What is your expected throughput when ingesting data? Can you data lake tolerate some delay at the benefit of reduced cost?</li> <li>Do you need to deploy infrastructure related to ingestion? What kinds of resources? Are specific authorization mechanisms needed for these?</li> </ul> <h2 id="azure-storage-account-1">Azure Storage Account</h2> <p><strong>Data Migration</strong></p> <p>When it comes to ingesting data into a Data Lake, the first level of ingestion usually involves the copying of raw data. In other words, data is ingestd as-is from the source and no data transformations take place. This simplifies things for the first-level ingestion, where you do not have to build an ETL pipeline to copy/move data.</p> <p>The Azure CLI <code class="language-plaintext highlighter-rouge">az storage blob copy</code> <a href="https://learn.microsoft.com/en-us/cli/azure/storage/blob/copy?view=azure-cli-latest" rel="external nofollow noopener" target="_blank">command</a> is helpful in performing such batch copy operations from the source Azure Storage Account to the destination (Data Lake) Azure Storage Account. The <a href="#authentication-and-authorization">authentication and authorization mechanisms</a> we discussed during the Azure Storage Account data sources can be used when running the command.</p> <p><strong>Event handling</strong></p> <p>Instead of scheduling a batch copy, we can ingest data using an event-driven mechanism. <a href="https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blob-event-overview" rel="external nofollow noopener" target="_blank">Azure Storage Accounts can be configured to send certain (specified via a filter) events to Azure Event Grid</a>. Event Grid then delivers these events to applications listening to it.</p> <p>Authentication can be implemented via Azure AD/Entra ID + RBAC as described above or here, where an <a href="https://learn.microsoft.com/en-us/azure/storage/blobs/authorize-access-azure-active-directory#overview-of-microsoft-entra-id-for-blobs" rel="external nofollow noopener" target="_blank">Oauth token is requested at runtime</a> to allow subscribing to events occurring from the Azure Storage Account.</p> <p><a href="https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blob-event-overview#filtering-events" rel="external nofollow noopener" target="_blank">Read here</a> about filtering events to be sent to the Event Grid. <a href="https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blob-event-overview#practices-for-consuming-events" rel="external nofollow noopener" target="_blank">Some caveats</a> to watch when using this option for ingestion.</p> <p><a href="https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blob-event-overview#practices-for-consuming-events" rel="external nofollow noopener" target="_blank">Azure Queue Storage</a> is one of the applications which can be configured to listen to Azure Event Grid. Your client application can then read queue messages from Azure Queue Storage. A Python code sample is available <a href="https://learn.microsoft.com/en-us/azure/storage/queues/storage-quickstart-queues-python?tabs=passwordless%2Croles-azure-portal%2Cenvironment-variable-windows%2Csign-in-visual-studio-code" rel="external nofollow noopener" target="_blank">here</a>.</p> <div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"azurerm_resource_group"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>     <span class="o">=</span> <span class="s2">"example-resources"</span>
  <span class="nx">location</span> <span class="o">=</span> <span class="s2">"West Europe"</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_storage_account"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>                     <span class="o">=</span> <span class="s2">"exampleasa"</span>
  <span class="nx">resource_group_name</span>      <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">location</span>                 <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">location</span>
  <span class="nx">account_tier</span>             <span class="o">=</span> <span class="s2">"Standard"</span>
  <span class="nx">account_replication_type</span> <span class="o">=</span> <span class="s2">"LRS"</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">environment</span> <span class="o">=</span> <span class="s2">"staging"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_storage_queue"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>                 <span class="o">=</span> <span class="s2">"example-astq"</span>
  <span class="nx">storage_account_name</span> <span class="o">=</span> <span class="nx">azurerm_storage_account</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">name</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_eventgrid_event_subscription"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>  <span class="o">=</span> <span class="s2">"example-aees"</span>
  <span class="nx">scope</span> <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">id</span>

  <span class="nx">storage_queue_endpoint</span> <span class="p">{</span>
    <span class="nx">storage_account_id</span> <span class="o">=</span> <span class="nx">azurerm_storage_account</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">id</span>
    <span class="nx">queue_name</span>         <span class="o">=</span> <span class="nx">azurerm_storage_queue</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">name</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_resource_group"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>     <span class="o">=</span> <span class="s2">"example-resources"</span>
  <span class="nx">location</span> <span class="o">=</span> <span class="s2">"West Europe"</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_storage_account"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>                     <span class="o">=</span> <span class="s2">"examplestorageacc"</span>
  <span class="nx">resource_group_name</span>      <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">location</span>                 <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">location</span>
  <span class="nx">account_tier</span>             <span class="o">=</span> <span class="s2">"Standard"</span>
  <span class="nx">account_replication_type</span> <span class="o">=</span> <span class="s2">"LRS"</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_storage_queue"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>                 <span class="o">=</span> <span class="s2">"mysamplequeue"</span>
  <span class="nx">storage_account_name</span> <span class="o">=</span> <span class="nx">azurerm_storage_account</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">name</span>
<span class="p">}</span>

</code></pre></div></div> <p><cite> – Terraform Docs.</cite></p> <h2 id="azure-event-hubs-1">Azure Event Hubs</h2> <p><strong>Azure Event Hubs for Kafka</strong></p> <p><a href="https://learn.microsoft.com/en-us/azure/event-hubs/azure-event-hubs-kafka-overview" rel="external nofollow noopener" target="_blank">Event Hubs data can be consumed using a Kafka Consumer</a>. The authentication mechanism is the same, and I prefer to use the SAS connection string created along with the authorization rule/policy.</p> <p>Usually, given larger volumes for a big data lake, we can configure <a href="https://learn.microsoft.com/en-us/azure/event-hubs/event-hubs-kafka-spark-tutorial#read-from-event-hubs-for-kafka" rel="external nofollow noopener" target="_blank">Spark Structured Streaming for Kafka</a> and consume events from Azure Event Hub. More information on configuring Kafka (bootstrap servers, security protocol, sasl mechanism, sasl jaas config etc.) and other settings <a href="https://learn.microsoft.com/en-us/azure/event-hubs/event-hubs-quickstart-kafka-enabled-event-hubs?tabs=connection-string#send-and-receive-messages-with-kafka-in-event-hubs" rel="external nofollow noopener" target="_blank">here</a>.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/eventhubs_kafka-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/eventhubs_kafka-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/eventhubs_kafka-1400.webp"></source> <img src="/assets/img/eventhubs_kafka.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><strong>Event handling</strong></p> <p>The same mechanism for event handling for Azure Storage Account applies to Event Hubs as well. And not just for Event Hubs, there are a <a href="https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blob-event-overview#the-event-model" rel="external nofollow noopener" target="_blank">number of Azure services</a> which can send data to Azure Event Grid.</p> <p>Once the <a href="#authentication-and-authorization-1">required permissions</a> are configured for Event Hubs, the topic can send data to the Event Grid.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/event_grid_queue_storage-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/event_grid_queue_storage-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/event_grid_queue_storage-1400.webp"></source> <img src="/assets/img/event_grid_queue_storage.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h1 id="design-decisions-and-trade-offs">Design decisions and trade-offs</h1> <h2 id="compute">Compute</h2> <p>Azure provides comprehensive documentation on different compute types. Based on your use case, you can follow the <a href="https://learn.microsoft.com/en-us/azure/architecture/guide/technology-choices/compute-decision-tree" rel="external nofollow noopener" target="_blank">flowchart here</a> and choose a compute type for your workloads.</p> <h2 id="storage--azure-storage-account">Storage / Azure Storage Account</h2> <p><a href="https://learn.microsoft.com/en-us/azure/storage/blobs/security-recommendations#loggingmonitoring" rel="external nofollow noopener" target="_blank">Security recommendations for Blog Storage.</a> - specifically data protection, networking and logging/monitoring sections.</p> <p>If you are storing sensitive data in your destination Azure Storage Account for the Data Lake, it is all the more important to setup <a href="https://learn.microsoft.com/en-us/azure/storage/blobs/monitor-blob-storage?tabs=azure-portal" rel="external nofollow noopener" target="_blank">logging and monitoring</a> for the Storage Account.</p> <p><strong>Access tiers, lifecycle management</strong></p> <p><a href="https://learn.microsoft.com/en-us/azure/storage/blobs/lifecycle-management-overview" rel="external nofollow noopener" target="_blank">Reading for this section.</a></p> <p>Azure Storage Management Policy.</p> <div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"azurerm_resource_group"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>     <span class="o">=</span> <span class="s2">"resourceGroupName"</span>
  <span class="nx">location</span> <span class="o">=</span> <span class="s2">"West Europe"</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_storage_account"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span>                <span class="o">=</span> <span class="s2">"storageaccountname"</span>
  <span class="nx">resource_group_name</span> <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">name</span>

  <span class="nx">location</span>                 <span class="o">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">location</span>
  <span class="nx">account_tier</span>             <span class="o">=</span> <span class="s2">"Standard"</span>
  <span class="nx">account_replication_type</span> <span class="o">=</span> <span class="s2">"LRS"</span>
  <span class="nx">account_kind</span>             <span class="o">=</span> <span class="s2">"BlobStorage"</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_storage_management_policy"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">storage_account_id</span> <span class="o">=</span> <span class="nx">azurerm_storage_account</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">id</span>

  <span class="nx">rule</span> <span class="p">{</span>
    <span class="nx">name</span>    <span class="o">=</span> <span class="s2">"rule1"</span>
    <span class="nx">enabled</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">filters</span> <span class="p">{</span>
      <span class="nx">prefix_match</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"container1/prefix1"</span><span class="p">]</span>
      <span class="nx">blob_types</span>   <span class="o">=</span> <span class="p">[</span><span class="s2">"blockBlob"</span><span class="p">]</span>
      <span class="nx">match_blob_index_tag</span> <span class="p">{</span>
        <span class="nx">name</span>      <span class="o">=</span> <span class="s2">"tag1"</span>
        <span class="nx">operation</span> <span class="o">=</span> <span class="s2">"=="</span>
        <span class="nx">value</span>     <span class="o">=</span> <span class="s2">"val1"</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">actions</span> <span class="p">{</span>
      <span class="nx">base_blob</span> <span class="p">{</span>
        <span class="nx">tier_to_cool_after_days_since_modification_greater_than</span>    <span class="o">=</span> <span class="mi">10</span>
        <span class="nx">tier_to_archive_after_days_since_modification_greater_than</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="nx">delete_after_days_since_modification_greater_than</span>          <span class="o">=</span> <span class="mi">100</span>
      <span class="p">}</span>
      <span class="nx">snapshot</span> <span class="p">{</span>
        <span class="nx">delete_after_days_since_creation_greater_than</span> <span class="o">=</span> <span class="mi">30</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">rule</span> <span class="p">{</span>
    <span class="nx">name</span>    <span class="o">=</span> <span class="s2">"rule2"</span>
    <span class="nx">enabled</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="nx">filters</span> <span class="p">{</span>
      <span class="nx">prefix_match</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"container2/prefix1"</span><span class="p">,</span> <span class="s2">"container2/prefix2"</span><span class="p">]</span>
      <span class="nx">blob_types</span>   <span class="o">=</span> <span class="p">[</span><span class="s2">"blockBlob"</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="nx">actions</span> <span class="p">{</span>
      <span class="nx">base_blob</span> <span class="p">{</span>
        <span class="nx">tier_to_cool_after_days_since_modification_greater_than</span>    <span class="o">=</span> <span class="mi">11</span>
        <span class="nx">tier_to_archive_after_days_since_modification_greater_than</span> <span class="o">=</span> <span class="mi">51</span>
        <span class="nx">delete_after_days_since_modification_greater_than</span>          <span class="o">=</span> <span class="mi">101</span>
      <span class="p">}</span>
      <span class="nx">snapshot</span> <span class="p">{</span>
        <span class="nx">change_tier_to_archive_after_days_since_creation</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="nx">change_tier_to_cool_after_days_since_creation</span>    <span class="o">=</span> <span class="mi">23</span>
        <span class="nx">delete_after_days_since_creation_greater_than</span>    <span class="o">=</span> <span class="mi">31</span>
      <span class="p">}</span>
      <span class="nx">version</span> <span class="p">{</span>
        <span class="nx">change_tier_to_archive_after_days_since_creation</span> <span class="o">=</span> <span class="mi">9</span>
        <span class="nx">change_tier_to_cool_after_days_since_creation</span>    <span class="o">=</span> <span class="mi">90</span>
        <span class="nx">delete_after_days_since_creation</span>                 <span class="o">=</span> <span class="mi">3</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><cite> – Terraform Docs.</cite></p> <p><strong>Performance, scalability</strong></p> <p><a href="https://learn.microsoft.com/en-us/azure/storage/blobs/storage-performance-checklist" rel="external nofollow noopener" target="_blank">Performance and scalability checklist for Azure Blog Storage.</a></p> <p><strong>Cost planning, optimization</strong></p> <p><a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-plan-manage-costs?toc=%2Fazure%2Fstorage%2Fblobs%2Ftoc.json&amp;bc=%2Fazure%2Fstorage%2Fblobs%2Fbreadcrumb%2Ftoc.json" rel="external nofollow noopener" target="_blank">Pricing for Azure Blog Storage.</a></p> <h2 id="analytics">Analytics</h2> <p>Azure offers a plethora of <a href="https://azure.microsoft.com/en-us/products/category/analytics" rel="external nofollow noopener" target="_blank">products</a> for Analytics. Choose a service which works for your workloads and use cases. I used Databricks.</p> <h1 id="conclusion">Conclusion</h1> <p>This article was an attempt to provide a reference to various Microsoft Azure services to design and build a scalable, performant and cost-efficient data lake.</p> <p>These services keep getting updated with newer features from time to time, so the latest Azure documentation will give more information related to them.</p> <p>Additionally, we touched upon a few topics for which there was excellent Azure documentation, so I just added links to them instead of repeating them here again.</p> <p>Each data lake effort has a variety of parameters such as available time, people in a team/organization, skills of the team, short term and long term goals for the project, users of the data lake, maintenance effort, operations and so on. It is important to keep these in mind while deciding on design, architecture and implementation.</p> </div> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Harish Kesava Rao. Last updated: December 07, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>