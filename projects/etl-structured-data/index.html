<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Parsing data from structured data sources. | Harish Kesava Rao</title> <meta name="author" content="Harish Kesava Rao"> <meta name="description" content="Parsing and transforming structured data."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="http://harishkesavarao.github.io//projects/etl-structured-data/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Harish Kesava Rao</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Parsing data from structured data sources.</h1> <p class="post-description">Parsing and transforming structured data.</p> </header> <article> <h1 id="introduction">Introduction</h1> <p>I worked on this project a few years ago.</p> <p>We had many Microsoft Excel sheets containing information about product versions. Each of these documents had many versions and each product line also had a document of its own.</p> <h1 id="use-cases">Use cases</h1> <p>Users of this data wanted a centralised location from which they could search, view and visualize the data. If a new version of the document is released, or if an existing document is updated, the destination dataset should reflect those as well.</p> <h2 id="considerations">Considerations</h2> <ol> <li>The data should be available for analysis - using interactive querying and/or visualization methods.</li> <li>The data should refresh automatically via batch jobs when there is new data. Additionally, this introduces the additional use case of detecting new data.</li> <li>The data should be secure and should be available to only a list of allowed individuals.</li> </ol> <h1 id="extraction">Extraction</h1> <p>Instead of focusing on the extraction first, I started to think of different ways in which one could store the data and then build a pipeline to read from the data sources.</p> <p>Based on the considerations above, the storage destination should be persisted. Some choices were:</p> <ol> <li>Relational databases.</li> <li>Spreadsheets.</li> <li>Other semi-structured formats such as JSON.</li> </ol> <p>I will discuss more on the storage destination in its own section below, and will now start discussing the design of landing the data to the destination.</p> <h2 id="design-choices">Design choices:</h2> <ol> <li>ETL tools.</li> <li>Connectivity from Microsoft Excel to Microsoft SQL Server (or any relational database).</li> <li>Custom scripting.</li> </ol> <h3 id="off-the-shelf-etl-tools">Off-the-shelf ETL tools.</h3> <p>I considered a host of options to reliably extract data from an XLSX document. Initially, I explored readily available products, such as contemporary ETL tools (Informatica et al.). I performed small, quick Proof Of Concept exercises to test the feasibility of the different tools. The tools were able to connect with the XSLX files and extract data, but I ran into the following challenges:</p> <ul> <li>The connectivity mainly depended on ODBC drivers, which could not be customized to suit the use case â€“ such as parsing through different sheets in the same document or extracting cells based on specific conditions.</li> <li>The tools were able to successfully connect and extract entire sheets into relational database tables. However, the data has to be completely imported in its raw state as tables and that caused complexities. The raw state could not be completely transformed to the desired structure, once it was imported into the ETL tool.</li> <li>The customizations were too cumbersome, given the limited options within the tools. Also, some tools allow scripting to be embedded into the ETL pipeline, which does help, but that also led to the idea of scripting the entire solution end-to-end, which is what I ended up doing, since it was very customizable and, at the same time, easier to develop from scratch.</li> </ul> <h3 id="connecting-ms-excel-to-ms-sql-server-directly">Connecting MS Excel to MS SQL Server directly</h3> <p>A second option was to try to connect to Microsoft SQL Server from Microsoft Excel. Microsoft has a plethora of <a href="https://learn.microsoft.com/en-us/sql/relational-databases/import-export/import-data-from-excel-to-sql?view=sql-server-ver16" rel="external nofollow noopener" target="_blank">options</a> to do so. And all of these options work quite well. The problem for this use case is customization and the final structure of the dataset.</p> <p>This option could have been pursued by an ELT pipeline/connection, where you land all the data as-is from Microsoft Excel to Microsoft SQL Server and then perform all the transformations inside MS SQL Server using ANSI SQL. The documents are created and uploaded manually to Microsoft Sharepoint, so the feature of detecting updates to existing documents or detecting the arrival of new documents would be available.</p> <p>This will work quite well, but it did come with some <a href="https://learn.microsoft.com/en-us/sql/integration-services/load-data-to-from-excel-with-ssis?view=sql-server-ver16#issues-importing" rel="external nofollow noopener" target="_blank">restrictions</a>.It also requires using Microsoft SSIS along with MS SQL Server, adding to the number of hops for the data as well as complexity.</p> <h3 id="custom-scripting">Custom scripting</h3> <p>Finally, having decided to pursue the scription route, I decided to use Python. Based on my past experience with Python for similar use cases (professionally as well as in other side projects), it is best suited for data analysis due to its large library support for data exploration, modification and analysis. Python also allows using a variety of built-in libraries, including Pandas, which makes data transformation even simpler and customizable.</p> <h2 id="transformation">Transformation</h2> <p>Going back to the considerations section, we have both querying and reporting use cases. As I explained the extraction section above as well as the storage section below, the destination is a relational database.</p> <p>The most suited structure to allow efficient reporting is a <a href="https://www.kimballgroup.com/1997/08/a-dimensional-modeling-manifesto/" rel="external nofollow noopener" target="_blank">star schema</a>.</p> <h3 id="implementation-steps">Implementation steps</h3> <ol> <li>Extract the data from the MS Excel sheets via Python. This includes the logic to identify and parse all the relevant files, to detect changes to existing files and to detect newly added files.</li> <li>Write the required/selected data from the sheets/documents into a staging schema in MS SQL Server.</li> <li>Write an ETL flow to convert the transactional schema to a dimensional schema, with appropriate dimensions and facts.</li> </ol> <h3 id="some-nuances-and-additional-facts-related-to-the-above-steps">Some nuances and additional facts related to the above steps</h3> <p>Initially, I explored Pandas to extract and transform the data. However, due to the structure of the data, this method proved cumbersome and slow. The entire dataset had to be read into a Pandas Dataframe and selection, filtering and data presentation for the final step was tedious.</p> <p>So, I used the <code class="language-plaintext highlighter-rouge">openpyxl</code> <a href="https://openpyxl.readthedocs.io/en/stable/" rel="external nofollow noopener" target="_blank">library</a>. The library contains a rich set of features for reading MS Excel data.</p> <p>Example code snippets from Openpyxl:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from openpyxl import load_workbook

# Open and load data from an existing Microsoft Excel workbook
wb = load_workbook(filename = 'empty_book.xlsx')

for sheet in wb:
    print(sheet.title)

# To access all rows in the active sheet
ws = wb.active
for row in ws.iter_rows(min_row=1, max_col=3, max_row=2):
    for cell in row:
        print(cell)
        
# To access all columns in the active sheet
for col in ws.iter_cols(min_row=1, max_col=3, max_row=2):
    for cell in col:
        print(cell)

# Selecting all the values from a sheet
for row in ws.values:
   for value in row:
     print(value)
</code></pre></div></div> <h2 id="storage-and-business-intelligence">Storage and Business Intelligence</h2> <p>I discussed this briefly in the transformation sectionâ€™s implementation steps.</p> <p>Once the data from the spreadsheets land into the staging schema of Microsoft SQL Server, a separate pipeline starts ingesting this data into a dimensional model: with identified dimensions and facts(measures).</p> <p>Some key dimensions: <code class="language-plaintext highlighter-rouge">date, products, versions</code>.</p> <p>For the reporting layer, Tableau was a good choice. MS SQL Server connects quite well with Tableau and different kinds of dashboards were built (by me and users) on top of the star schema tables. I wrote some views on top of the tables as well, primarily to join the dimension and fact tables.</p> <h1 id="conclusion">Conclusion</h1> <p>This was an interesting project to convert structured data into a dimensional model. This also allowed some experimentation with Python which was later used in other projects.</p> <p>Overall, the dimensional model and the Tableau dashboards allowed users to access and visualize data in new ways and to make decisions out of them.</p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> Â© Copyright 2024 Harish Kesava Rao. Last updated: January 01, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>